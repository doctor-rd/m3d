<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>m3d</title>
  </head>
  <body>
    <canvas id="glcanvas" width="600" height="600"></canvas>
    <script>
      const gl = document.getElementById("glcanvas").getContext("webgl");

      function loadShader(type, source) {
        const shader = gl.createShader(type);
        gl.shaderSource(shader, source);
        gl.compileShader(shader);
        return shader;
      }

      const vertTmp = `
        attribute vec2 position;
        uniform float time;
        uniform vec2 move;
        uniform mat4 Pmatrix;
        uniform mat4 Vmatrix;
        uniform mat4 Mmatrix;
        float func(vec2 p, float t) {
          return 0.0;
        }
        void main(void) {
          vec2 position = position + move;
          gl_Position = Pmatrix*Vmatrix*Mmatrix*vec4(position.x, func(position, time), position.y, 1.0);
        }
      `;

      const fragSource = `
        void main(void) {
          gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
        }
      `;

      function setfunc(str) {
        const vertSource = vertTmp.replace('0.0', str);
      }

      let drag = false;
      let old_x, old_y;
      let THETA = 0;
      let PHI = 0;

      function mouseDown(e) {
        drag = true;
        old_x = e.pageX;
        old_y = e.pageY;
        return false;
      }

      function mouseUp(e) {
        drag = false;
      }

      function mouseMove(e) {
        if (!drag) return false;
        THETA += (e.pageX-old_x)*2*Math.PI/gl.canvas.width;
        PHI += (e.pageY-old_y)*2*Math.PI/gl.canvas.height;
        if (PHI<-.8) PHI=-.8;
        if (PHI>.8) PHI=.8;
        old_x = e.pageX;
        old_y = e.pageY;
      }

      gl.canvas.addEventListener("mousedown", mouseDown, false);
      gl.canvas.addEventListener("mouseup", mouseUp, false);
      gl.canvas.addEventListener("mouseout", mouseUp, false);
      gl.canvas.addEventListener("mousemove", mouseMove, false);

      let then = 0;
      function step(now) {
        deltaTime = now - then;
        then = now;

        gl.clearColor(0.0, 0.0, 0.0, 1.0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    </script>
  </body>
</html>
